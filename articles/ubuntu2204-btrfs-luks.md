---
title: "Ubuntu22.04をBtrfs+luks+LVM+TPMな環境にインストール"
emoji: "✨"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ubuntu", "debian","linux","btrfs","LUKS"]
published: false
---

## はじめに

モバイルノートPCにUbuntuをインストールしている方は、次のような悩みを持っていることが多いかもしれません。

- 紛失時のデータ保護をどうするか
- LUKSを使うと起動時にパスワードを入力しなければならなくて面倒くさい
- バックアップを取ることが大変

そこで、今回はBtrfs,LUKS,lvm,tpmを組み合わせることで、上記の問題を解決していこうと思います。

## この記事のゴール

この記事では、Ubuntu 22.04 LTSを以下の環境でインストールする手順を説明します。

- ボリュームをLUKSを使用して暗号化する
- LUKSの上にはlvmを作成
- lvmの上にBtrfsの論理ボリュームを作ってrootにマウントする
- LUKSをTPMを使用してセキュアに自動復号化する

## 使用する技術のメリット

### LUKS

LUKS (Linux Unified Key Setup) は、Linuxで使用できる暗号化ファイルシステムです。LUKSを使用してrootパーティションを暗号化することで、コンピューターが紛失した場合でもデータを保護できます。

### LVM

> LVM（logical volume manager）とは、複数のハードディスクやパーティションにまたがった記憶領域をひとつのボリュームグループにまとめ、単一の論理ボリューム（LV）として扱うことのできるディスク管理機能です。
[IDCFrontier 論理ボリュームマネージャーより](https://www.idcf.jp/words/lvm.html)

LVMを使用することによって、将来パーティションの構成を変更したくなった場合でも柔軟に対応できます。

### btrfs

> Btrfs は、耐障害性、修復、および簡単な管理に重点を置きながら、高度な機能を実装することを目的とした Linux 用の最新のコピーオンライト(CoW)ファイルシステムです。複数の企業で共同開発された Btrfs は、GPL に基づいてライセンスされており、誰からの寄付も受け付けています。
[Btrfs Wikiより](https://archive.kernel.org/oldwiki/btrfs.wiki.kernel.org/index.php/Main_Page.html)

rootにBtrfsファイルシステムを使用することで下記のメリットがあります。

- Snapshot機能が備わっており、システムのバックアップやリストアが一瞬で行えます。
- ファイルシステムを圧縮することができ、ストレージの節約とSSDの寿命を少し伸ばすことができます。

### TPM

LUKSを起動時にマウントするためには通常、以下の二通りが考えられます。

- パスワードを起動時に入力する。
- Keyfileを暗号化されていないボリュームに保存して起動時に読み込ませる。

これにはいくつかの問題があります。
